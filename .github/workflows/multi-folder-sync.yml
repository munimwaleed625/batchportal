name: Multi-folder-sync-event

on:
  workflow_dispatch:
    inputs:
      folders:
        description: 'Folders to sync from batchportal'
        required: true
        type: string
        default: 'resources,routes'

jobs:
  trigger-multi-sync:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger sync for each folder
        run: |
          FOLDERS="${{ inputs.folders }}"
          IFS=',' read -ra FOLDER_ARRAY <<< "$FOLDERS"

          for folder in "${FOLDER_ARRAY[@]}"; do
            folder=$(echo "$folder" | xargs)

          curl -X POST \
          -H "Accept: application/vnd.github.v3+json" \
          -H "Authorization: token ${{ secrets.MERGE_PAT }}" \
          https://api.github.com/repos/munimwaleed625/hbas/dispatches \
          -d "{
          \"event_type\": \"sync-folder\",
          \"client_payload\": {
            \"folder\": \"$folder\",
            \"dest\": \"$folder\"
          }
          }"

          sleep 3
          done
